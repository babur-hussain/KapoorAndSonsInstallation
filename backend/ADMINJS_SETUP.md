# AdminJS Setup Guide

This guide explains the AdminJS dashboard configuration for the Kapoor & Sons Demo Booking System.

## Overview

AdminJS provides a comprehensive admin panel for managing:
- **Bookings** - View and manage all demo bookings
- **Brands** - Manage brands with communication preferences
- **Models** - Manage product models linked to brands
- **Users** - Manage user accounts and roles
- **System Logs** - View activity logs and notifications

## Dashboard Access

**URL:** http://localhost:4000/admin

**Note:** Currently, AdminJS is open without authentication. For production, you should add authentication.

## Resources

### 1. Bookings

**Navigation:** Bookings â†’ Calendar icon

**Features:**
- View all bookings sorted by creation date (newest first)
- Filter by status, date, brand
- Update booking status
- View customer details (read-only)

**Fields:**
- Customer Name (title field)
- Contact Number
- Address
- Brand
- Model
- Invoice Number
- Preferred Date/Time
- Status (Pending, Confirmed, In Progress, Completed, Cancelled)
- Created At / Updated At

**Status Options:**
- â³ Pending
- âœ… Confirmed
- ðŸ”„ In Progress
- âœ”ï¸ Completed
- âŒ Cancelled

### 2. Brands

**Navigation:** Brands & Models â†’ Settings icon

**Features:**
- Add/edit/delete brands
- Configure communication preferences
- Set contact information
- Enable/disable brands

**Fields:**
- Name (required, unique)
- Logo (URL or path to image)
- Contact Email
- WhatsApp Number (with country code, e.g., +919876543210)
- Communication Mode:
  - ðŸ“§ Email Only
  - ðŸ’¬ WhatsApp Only
  - ðŸ“§ðŸ’¬ Both Email & WhatsApp
- Is Active (enable/disable)

**Example:**
```
Name: Samsung
Logo: https://example.com/samsung-logo.png
Contact Email: samsung@example.com
WhatsApp Number: +919876543210
Communication Mode: Both Email & WhatsApp
Is Active: Yes
```

### 3. Models

**Navigation:** Brands & Models â†’ Settings icon

**Features:**
- Add/edit/delete product models
- Link models to brands
- Add descriptions and specifications
- Enable/disable models

**Fields:**
- Name (required)
- Brand (required, reference to Brand)
- Description
- Specifications
- Is Active (enable/disable)

**Example:**
```
Name: Galaxy S24
Brand: Samsung
Description: Latest flagship smartphone with AI features
Specifications: 6.2 inch display, 8GB RAM, 256GB storage
Is Active: Yes
```

**Note:** Each brand can have multiple models. The combination of brand + model name must be unique.

### 4. Users

**Navigation:** User Management â†’ User icon

**Features:**
- View all registered users
- Create new users
- Edit user details
- Change user roles
- Delete users

**Fields:**
- Name (title field)
- Email (unique)
- Phone
- Role:
  - ðŸ‘¤ Customer (default)
  - ðŸ‘· Staff
  - ðŸ‘‘ Admin
- Password (hidden in list/show, editable)
- Created At / Updated At

**Role Permissions:**
- **Customer:** Can create and view own bookings
- **Staff:** Can view all bookings (for future installer features)
- **Admin:** Full access to all resources and admin stats

### 5. System Logs

**Navigation:** System Logs â†’ Activity icon

**Features:**
- View all system activities
- Filter by type, severity, date
- View related booking details
- Delete old logs (cleanup)

**Log Types:**
- ðŸ“ Booking Created
- âœï¸ Booking Updated
- ðŸ”„ Status Updated
- ðŸ’¬ Message Sent (WhatsApp)
- ðŸ”” Notification Sent (Email)
- âŒ Notification Failed
- ðŸ¢ Brand Created
- ðŸ¢ Brand Updated

**Severity Levels:**
- â„¹ï¸ Info
- âœ… Success
- âš ï¸ Warning
- âŒ Error

**Note:** Logs cannot be created or edited manually. They are automatically generated by the system.

## Dashboard

The dashboard displays key metrics and statistics:

### Key Metrics
- Total Bookings
- Active Brands
- Total Users
- Activity Logs

### Booking Status Breakdown
- Count by status (Pending, Confirmed, In Progress, Completed, Cancelled)

### Top Brands by Bookings
- Brands ranked by number of bookings

### Recent Activity Summary
- Activity log counts by type

### User Role Distribution
- User counts by role (Customer, Staff, Admin)

## API Endpoints

### Brands API

**Get all active brands:**
```bash
GET /api/v1/brands
```

**Response:**
```json
{
  "success": true,
  "count": 4,
  "data": [
    {
      "_id": "690cdfea92b85b4723e3b2bf",
      "name": "Samsung",
      "logo": "https://example.com/samsung-logo.png"
    }
  ]
}
```

**Get brand by ID:**
```bash
GET /api/v1/brands/:id
```

### Models API

**Get all active models:**
```bash
GET /api/v1/models
```

**Get models by brand ID:**
```bash
GET /api/v1/models?brand=690cdfea92b85b4723e3b2bf
```

**Get models by brand name:**
```bash
GET /api/v1/models/by-brand/Samsung
```

**Response:**
```json
{
  "success": true,
  "count": 2,
  "data": [
    {
      "_id": "690cf5a20584977e416bd15e",
      "name": "Galaxy S24",
      "brand": {
        "_id": "690cdfea92b85b4723e3b2bf",
        "name": "Samsung",
        "logo": "https://example.com/samsung-logo.png"
      },
      "description": "Latest flagship smartphone with AI features",
      "specifications": "6.2 inch display, 8GB RAM, 256GB storage"
    }
  ]
}
```

## Usage Workflow

### 1. Initial Setup

1. **Add Brands:**
   - Go to AdminJS â†’ Brands & Models â†’ Brands
   - Click "Create new"
   - Fill in brand details
   - Set communication preferences
   - Save

2. **Add Models:**
   - Go to AdminJS â†’ Brands & Models â†’ Models
   - Click "Create new"
   - Select brand from dropdown
   - Fill in model details
   - Save

3. **Create Users:**
   - Go to AdminJS â†’ User Management â†’ Users
   - Click "Create new"
   - Fill in user details
   - Select role
   - Save

### 2. Managing Bookings

1. **View Bookings:**
   - Go to AdminJS â†’ Bookings
   - See all bookings sorted by date
   - Use filters to find specific bookings

2. **Update Status:**
   - Click on a booking
   - Change status dropdown
   - Save changes
   - System automatically logs the status change

3. **Check Notifications:**
   - Go to System Logs
   - Filter by "Message Sent" or "Notification Sent"
   - Verify notifications were sent successfully

### 3. Mobile App Integration

The mobile app uses the Brands and Models APIs to populate dropdowns:

**Booking Form Flow:**
1. App fetches brands: `GET /api/v1/brands`
2. User selects brand
3. App fetches models: `GET /api/v1/models/by-brand/:brandName`
4. User selects model
5. User fills in other details
6. App creates booking: `POST /api/v1/bookings`
7. Backend sends notifications based on brand preferences

## Testing

### Test Brands API
```bash
curl http://localhost:4000/api/v1/brands | python3 -m json.tool
```

### Test Models API
```bash
curl http://localhost:4000/api/v1/models | python3 -m json.tool
```

### Test Models by Brand
```bash
curl "http://localhost:4000/api/v1/models/by-brand/Samsung" | python3 -m json.tool
```

### Create Sample Data

**Via MongoDB:**
```bash
mongosh kapoorsons --eval '
var samsung = db.brands.findOne({name: "Samsung"});
db.models.insertOne({
  name: "Galaxy S24",
  brand: samsung._id,
  description: "Latest flagship smartphone",
  specifications: "6.2 inch, 8GB RAM, 256GB storage",
  isActive: true,
  createdAt: new Date(),
  updatedAt: new Date()
});
'
```

**Via AdminJS:**
1. Open http://localhost:4000/admin
2. Navigate to Models
3. Click "Create new"
4. Fill in details
5. Save

## Production Considerations

### 1. Add Authentication

AdminJS currently has no authentication. For production:

```javascript
import bcrypt from "bcryptjs";

const adminRouter = AdminJSExpress.buildAuthenticatedRouter(admin, {
  authenticate: async (email, password) => {
    // Verify admin credentials
    const user = await User.findOne({ email, role: "admin" });
    if (user && await bcrypt.compare(password, user.password)) {
      return user;
    }
    return null;
  },
  cookiePassword: process.env.ADMIN_COOKIE_SECRET,
});
```

### 2. Restrict Access

- Only allow admin role to access AdminJS
- Add IP whitelisting
- Use HTTPS in production

### 3. File Uploads

For brand logos, consider using:
- AWS S3
- Cloudinary
- Local file storage with proper validation

### 4. Backup

- Regular database backups
- Export activity logs periodically
- Keep audit trail of admin actions

## Troubleshooting

### AdminJS not loading

**Check:**
1. Server is running: `npm start`
2. MongoDB is connected
3. No console errors in browser
4. Port 4000 is not blocked

### Dashboard shows no data

**Check:**
1. Database has data: `mongosh kapoorsons --eval 'db.bookings.count()'`
2. API endpoint works: `curl http://localhost:4000/api/v1/admin/stats`
3. Browser console for errors

### Models not showing in dropdown

**Check:**
1. Models exist: `curl http://localhost:4000/api/v1/models`
2. Models are active: `isActive: true`
3. Models are linked to correct brand

### Notifications not sent

**Check:**
1. Brand has communication preferences set
2. Twilio/Email credentials configured
3. System Logs for error messages
4. Run test script: `node src/utils/testNotifications.js`

## File Structure

```
backend/src/
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ admin.js                 # AdminJS configuration
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ index.js             # Component loader
â”‚       â””â”€â”€ Dashboard.jsx        # Custom dashboard
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ Brand.js                 # Brand schema
â”‚   â”œâ”€â”€ Model.js                 # Model schema
â”‚   â”œâ”€â”€ Booking.js               # Booking schema
â”‚   â”œâ”€â”€ User.js                  # User schema
â”‚   â””â”€â”€ ActivityLog.js           # Activity log schema
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ brandRoutes.js           # Brand API routes
â”‚   â”œâ”€â”€ modelRoutes.js           # Model API routes
â”‚   â”œâ”€â”€ bookingRoutes.js         # Booking API routes
â”‚   â””â”€â”€ adminStats.js            # Admin stats API
â””â”€â”€ app.js                       # Express app with routes
```

---

**Last Updated:** 2025-11-06  
**Version:** 1.0.0

